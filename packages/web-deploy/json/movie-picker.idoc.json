{
    "$schema": "../../../docs/schema/idoc_v1.json",
    "title": "Movies Database Explorer",
    "style": {
        "css": [
            "body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f5f7fa; }",
            "#header, .filter-stage { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }",
            "#header { background: #667eea; color: white; text-align: center; }",
            "h1 { margin: 0; padding: 10px 0; font-size: 1.8em; font-weight: 400; }",
            "h2 { margin: 0 0 15px 0; color: #333; font-size: 1.2em; }",
            ".tabulator { max-width: 100%; overflow: auto; }"
        ]
    },
    "dataLoaders": [
        {
            "dataSourceName": "moviesData",
            "type": "url",
            "format": "json",
            "url": "https://vega.github.io/editor/data/movies.json"
        }
    ],
    "variables": [
        {
            "variableId": "selectedGenre",
            "type": "string",
            "initialValue": ""
        },
        {
            "variableId": "tableHeaderText",
            "type": "string",
            "initialValue": "All Movies",
            "calculation": {
                "vegaExpression": "selectedGenre && selectedGenre !== 'null' && selectedGenre !== '' ? selectedGenre + ' Movies' : 'All Movies'"
            }
        },
        {
            "variableId": "filteredByGenre",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": ["moviesData"],
                "dataFrameTransformations": [
                    {
                        "type": "filter",
                        "expr": "!selectedGenre || selectedGenre === '' || selectedGenre === 'null' || datum['Major Genre'] === selectedGenre"
                    }
                ]
            }
        },
        {
            "variableId": "selectedDirector",
            "type": "string",
            "initialValue": ""
        },
        {
            "variableId": "filteredByDirector",
            "type": "object",
            "isArray": true,
            "initialValue": [],
            "calculation": {
                "dataSourceNames": ["filteredByGenre"],
                "dataFrameTransformations": [
                    {
                        "type": "filter",
                        "expr": "!selectedDirector || selectedDirector === '' || selectedDirector === 'null' || datum['Director'] === selectedDirector"
                    }
                ]
            }
        },
        {
            "variableId": "directorTableHeaderText",
            "type": "string",
            "initialValue": "All Directors",
            "calculation": {
                "vegaExpression": "selectedDirector && selectedDirector !== 'null' && selectedDirector !== '' ? selectedDirector + ' Movies' : 'All Directors'"
            }
        }
    ],
    "groups": [
        {
            "groupId": "header",
            "elements": [
                "# Movies Database Explorer"
            ]
        },
        {
            "groupId": "genreFilter",
            "className": "filter-stage",
            "elements": [
                "## Step 1: Filter by Genre\n\n**Select Genre:**",
                {
                    "type": "dropdown",
                    "variableId": "selectedGenre",
                    "dynamicOptions": {
                        "dataSourceName": "moviesData",
                        "fieldName": "Major Genre"
                    }
                },
                "## {{tableHeaderText}}\n",
                {
                    "type": "tabulator",
                    "dataSourceName": "filteredByGenre",
                    "tabulatorOptions": {
                        "autoColumns": true,
                        "layout": "fitColumns",
                        "minHeight": "400px",
                        "maxHeight": "400px",
                        "pagination": "local",
                        "paginationSize": 15
                    }
                }
            ]
        },
        {
            "groupId": "directorFilter",
            "className": "filter-stage",
            "elements": [
                "## Step 2: Filter by Director\n\n**Select Director:**",
                {
                    "type": "dropdown",
                    "variableId": "selectedDirector",
                    "dynamicOptions": {
                        "dataSourceName": "filteredByGenre",
                        "fieldName": "Director"
                    }
                },
                "## {{directorTableHeaderText}}\n",
                {
                    "type": "tabulator",
                    "dataSourceName": "filteredByDirector",
                    "tabulatorOptions": {
                        "autoColumns": true,
                        "layout": "fitColumns",
                        "minHeight": "400px",
                        "maxHeight": "400px",
                        "pagination": "local",
                        "paginationSize": 15,
                        "columns": [
                            {"title": "Title", "field": "Title"},
                            {"title": "Director", "field": "Director", "visible": false},
                            {"title": "Release Date", "field": "Release Date"},
                            {"title": "MPAA Rating", "field": "MPAA Rating"},
                            {"title": "Running Time", "field": "Running Time min"},
                            {"title": "IMDB Rating", "field": "IMDB Rating"},
                            {"title": "US Gross", "field": "US Gross", "formatter": "money"},
                            {"title": "Worldwide Gross", "field": "Worldwide Gross", "formatter": "money"}
                        ]
                    }
                }
            ]
        }
    ]
}